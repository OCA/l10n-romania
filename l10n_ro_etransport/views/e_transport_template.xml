<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <template id="e_transport">
        <eTransport
            xmlns="mfp:anaf:dgti:eTransport:declaratie:v2"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="mfp:anaf:dgti:eTransport:declaratie:v2 eTransport.xsd"
            t-att-codDeclarant="company.vat.upper().replace('RO', '')"
            t-att-refDeclarant="doc.name"
        >
            <notificare t-att-codTipOperatiune="doc.l10n_ro_e_transport_tip_operatie">
                <t t-foreach="doc.move_ids" t-as="move">
                    <t t-foreach="move.move_line_ids" t-as="move_line">
                        <t
                            t-set="qty"
                            t-value="move_line.qty_done or move_line.product_uom_qty"
                        />
                        <bunuriTransportate
                            t-att-codTarifar="get_instastat_code(move.product_id)"
                            t-att-denumireMarfa="move.product_id.name"
                            t-att-cantitate="move_line.qty_done or move_line.product_uom_qty"
                            t-att-codUnitateMasura="move.product_uom._get_unece_code()"
                            t-att-greutateNeta="qty * (move.product_id.l10n_ro_net_weight or 1)"
                            t-att-greutateBruta="qty* (move.product_id.weight or 1)"
                            t-att-codScopOperatiune="doc.l10n_ro_e_transport_scop or '101'"
                            t-att-valoareLeiFaraTva="qty * (move_line.product_id.standard_price or 1)"
                        />
                    </t>
                </t>

                <partenerComercial
                    t-att-codTara="doc.partner_id.commercial_partner_id.country_id.code or ''"
                    t-att-cod="doc.partner_id.commercial_partner_id.vat.upper().replace('RO', '')"
                    t-att-denumire="doc.partner_id.commercial_partner_id.name"
                />
                <t t-set="carrier" t-value="doc.carrier_id.l10n_ro_e_partner_id" />
                <dateTransport
                    t-att-nrVehicul="doc.l10n_ro_vehicle and doc.l10n_ro_vehicle.upper().replace('-', '')"
                    t-att-codOrgTransport="carrier.vat.upper().replace('RO', '')"
                    t-att-codTaraOrgTransport="get_country_code(carrier.country_id.code)"
                    t-att-denumireOrgTransport="carrier.name"
                    t-att-dataTransport="doc.date.date()"
                />
                <locStartTraseuRutier t-if="doc.l10n_ro_e_transport_tip_operatie!='10'">
                    <locatie
                        t-att-codJudet="STATE_CODES[doc.company_id.state_id.code]"
                        t-att-denumireLocalitate="doc.company_id.city"
                        t-att-denumireStrada="doc.company_id.street"
                        t-att-numar="doc.company_id.street2"
                        t-att-alteInfo="doc.company_id.street2"
                    />
                </locStartTraseuRutier>
                <locFinalTraseuRutier
                    t-if="doc.l10n_ro_e_transport_tip_operatie=='10'"
                    t-att-codPtf="doc.l10n_ro_e_transport_vama"
                />
                <locFinalTraseuRutier t-if="doc.l10n_ro_e_transport_tip_operatie!='20'">
                    <locatie
                        t-att-codJudet="STATE_CODES[doc.partner_id.state_id.code]"
                        t-att-denumireLocalitate="doc.partner_id.city"
                        t-att-denumireStrada="doc.partner_id.city"
                        t-att-codPostal="doc.partner_id.zip"
                    />
                </locFinalTraseuRutier>
                <locFinalTraseuRutier
                    t-if="doc.l10n_ro_e_transport_tip_operatie=='20'"
                    t-att-codPtf="doc.l10n_ro_e_transport_vama"
                />

                <documenteTransport
                    tipDocument="30"
                    t-att-numarDocument="doc.name"
                    t-att-dataDocument="doc.date.date()"
                />


            </notificare>
        </eTransport>

    </template>

</odoo>
